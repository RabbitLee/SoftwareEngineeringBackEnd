# 详细设计

## 登录
### 前端->后端
**prefix: /login**  
post:   

    url: http://rabbitlee.me/login/isUserValid,
    data: {
        name: string,
        password: string
    }

    returnValue: {
        isValid: boolean
    }

### 后端->数据库
**file position: database/loginOperate.py**  

    def isUserValid(name, password):
        ...
        return { boolean }


## 注册
### 前端->后端
**prefix: /register**
post:

    url: http://rabbitlee.me/register/,
    data: {
        name: string,
        password: string,
        email: string,
        phone: int(11)
    }

    returnValue: {
        isValid: boolean       // 用户名是否重复
    }

### 后端->数据库
**file position: database/registerOperate.py**

    def register(name, password, email, phone) {
        ...
        return { boolean }      // 用户名是否重复
    }


## 选择景点
### 前端->后端
**prefix: /selectSpots**  
post: //  获取高德开发者账号

    url: http://rabbitlee.me/selectSpots/getGaodeDeveloperKey,
    data: {
        null
    }

    returnValue: {
        key: string
    }

post: // 选择省份

    url: http://rabbitlee.me/selectSpots/getAllProvinces,
    data: {
        null
    }

    returnValue: {
        provinces: [‘provinceName1’, 'provinceName2', ...]
    }

post: // 选择城市

    url: http://rabbitlee.me/selectSpots/getAllCities,
    data: {
        provinceName: string
    }

    returnValue: {
        cities: ['cityName1', 'cityName2', ...]
    }

post: // 选择景点

    url: http://rabbitlee.me/selectSpots/getAllSpots,
    data: {
        cityName: string
    }

    returnValue: {
        spots: [{name: 'spotName1', id: string, visit_time: int, coordinate: [x, y], level: int},
            {name: 'spotName2', id: string， visit_time: int， coordinate: [x, y], level: int},
            ...]，   // visit_time 单位为分钟, level: 0为普通景点， 1为推荐景点
    }

post: // 提交

    url: http://rabbitlee.me/selectSpots/submitSelectedSpots,
    data: {
        date: [start_date, end_date],
        spots_id: [id1, id2, ...]
    }

    returnValue: {
        spots_id: [[id1_1, id1_2, ...],[id2_1, id2_2, ...], ...],
        time: [[[start_time1_1, end_time1_1], [start_time1_2, endtime1_2], ...], ...],
        name: [[name1_1, name1_2, ...], ...],
        coordinate: [[[x1_1, y1_1], [x1_2, y1_2], ...], ...]        
    }

post: // 确认展示的路线

    url: http://rabbitlee.me/selectSpots/confirmSelectedSpots,
    data: {
        shared: int, //0为否，1为公开
        user: string, //ejs
        spots_id: [[id1_1, id1_2, ...],[id2_1, id2_2, ...], ...],
        date: [start_date, end_date],
        time: [[[start_time1_1, end_time1_1, [start_time1_2, endtime1_2], ...], ...],
         
    }

    returnValue: {
        success: boolean //保存到数据库中成功    
    }

### 后端->数据库
**file position: database/selectSpotsOperate.py**
```python
    # 选择省份
    def getAllProvinces():
        ...
        return ['provinceName1', 'provinceName2', ...]

    # 选择城市
    def getAllCities(provinceName):
        ...
        return {
            cities: ['cityName1', 'cityName2', ...]
        }

    # 选择景点
    def getAllSpots(cityName):
        ...
        return {
            centerPosition: [lng, lat],
            spots: [{name: 'spotName1', id: string, visit_time: int, lngLat: [lng, lat]},
                {name: 'spotName2', id: string， visit_time: int, lngLat: [lng, lat]},
                ...]，   // visit_time 单位为分钟
            recommendedSpots: [id1, id2, ...]
        }

    # 获取同一城市给定景点间的最短路线所需时间（单位与景点游玩时间相同）
    def getTimeBetweenSpots(spots[spot1_id, spot2_id, ...]):
        ...
        return [[1_1, 1_2, ...], [2_1, 2_2, ...], [], ...]
        # 类似二维数组 t[i][j] 表示第i，j 个景点间距离，从0开始计数

    # 存入路线
    def saveRoute(userId, spots[spot1_id, spot2_id, ...]):
        ...
        return routeId
        # 需将信息存入 user 与 route 两个表中，并返回系统生成的 id

```
