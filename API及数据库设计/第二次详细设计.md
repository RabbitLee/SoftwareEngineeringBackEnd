# 详细设计

## 广场
+ 路线列表： 景点（第一个和最后一个）
+ 某一条路线：所有信息
+ 拼团：用户加入当前路线
+ 旅行社选择路线，出价，投票

### ejs

### 前端->后端
**prefix: /square**

post://展示所有路线列表

```javascript
    url: http://rabbitlee.me/square/showAllRoute
    data: {
        null
    }

    returnValue: {
        list: [{routeId: id1, creator: username1, date:[start_date1, end_date1], city: cityname1, spot: [start_spot1, end_spot1]},
        {routeId: id2, creator: username2, date:[start_date2, end_date2], city: cityname2, spot: [start_spot2, end_spot2]}, ...]
    }

    url: http://rabbitlee.me/square/showRouteInPage
    data: {
        page: int
    }

    returnValue: {
        pageCount: int,
        list: [{routeId: id1, creator: username1, date:[start_date1, end_date1], city: cityname1, spot: [start_spot1, end_spot1]},
        {routeId: id2, creator: username2, date:[start_date2, end_date2], city: cityname2, spot: [start_spot2, end_spot2]}, ...]
    }
```

post: //展示选择的路线  

    url: http://rabbitlee.me/square/getSelectedRoute
    data: {
        user: string, //ejs
        detailRouteID: string
    }

    returnValue: {
        routeId: //详细route的Id
        creator: string,
        city: string,
        participants: [[userName1, voteFor1], [userName2, voteFor2] ...],
        myVote: string, //当前用户投票的旅行社
        agency: [{agencyID: 'agency1', fare: int, poll: int}, {agencyID: 'agency2', fare: int, poll: int}, ...],
        spots_id: [[id1_1, id1_2, ...],[id2_1, id2_2, ...], ...],
        time: [[[start_time1_1, end_time1_1], [start_time1_2, endtime1_2], ...], ...],
        date: [start_date, end_date],
        spotsName: [[name1_1, name1_2, ...], ...],
        coordinate: [[[x1_1, y1_1], [x1_2, y1_2], ...], ...]        
    }


post: //用户加入当前路线

    url: http://rabbitlee.me/square/joinRoute
    data: {
        user: string, //ejs
        detailRouteID:
    }

    returnValue: {
        success: boolean        
    }
post: //用户投票

    url: http://rabbitlee.me/square/voteRoute
    data: {
        user: string, //ejs
        voteFor: string,
        detailRouteID:
    }

    returnValue: {
        success: boolean        
    }

post: //旅行社出价

    url: http://rabbitlee.me/square/bidForRoute
    data: {
        agency: string, //ejs
        bidFor: string, //route
        fare: int
    }

    returnValue: {
        success: boolean        
    }

### 后端->数据库
**file position: database/registerOperate.py**

    def getRoute(detailRouteID):
        ...
        return {
            creator: userName,
            participants: [[userName1, voteFor1], [userName2, voteFor2] ...],
            myVote: string, //当前用户投票的旅行社
            agency: [{agencyName: 'agency1', fare: int, poll: int}, {agencyName: 'agency2', fare: int, poll: int}, ...],
            spots_id: [[id1_1, id1_2, ...],[id2_1, id2_2, ...], ...],
            time: [[[start_time1_1, end_time1_1], [start_time1_2, endtime1_2], ...], ...],
            date: [start_date, end_date],
            spotsName: [[name1_1, name1_2, ...], ...],
            coordinate: [[[x1_1, y1_1], [x1_2, y1_2], ...], ...]
        }


## 旅行社,管理员登录
post:   

    url: http://rabbitlee.me/agencyLogin/isUserValid,
    data: {
        name: string,
        password: string
    }

    returnValue: {
        isValid: boolean
    }

### 后端->数据库
**file position: database/loginOperate.py**  

    def isUserValid(name, password):
        ...
        return { boolean }
